<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roomix — Encuentra tu habitación</title>

  <!-- Enlaza la hoja de estilos -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Tipografía: usar Google Fonts (Montserrat y Open Sans) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
  <!-- NAVBAR -->
  <header class="site-header">
    <div class="container header-inner">
      <div class="logo">
        <svg width="36" height="28" viewBox="0 0 24 20" aria-hidden="true" focusable="false">
          <path fill="#00B8A9" d="M12 1.5L1 9v9a1 1 0 0 0 1 1h6v-6h6v6h6a1 1 0 0 0 1-1V9L12 1.5z"/>
        </svg>
        <span class="brand">roomix</span>
      </div>
      <nav class="nav-actions" aria-label="Acciones">
        <a href="#" class="signin">Iniciar Sesión</a>
        <a href="#" class="signup">Regístrate</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero-inner">
      <h1 class="hero-title">Tu próxima habitación te está esperando</h1>
      <p class="hero-sub">Conecta con personas afines y encuentra el espacio perfecto para vivir, compartir y disfrutar.</p>
      <a class="cta" href="#">Comenzar</a>
    </div>
  </section>

  <!-- CARDS / LISTADO -->
  <main class="container main-content">
    <section class="listings">
      <p id="loading">Cargando habitaciones disponibles...</p>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p class="footer-slogan">
        Roomix — Conectando personas, creando hogares.
      </p>
      <p class="footer-legal">
        <a href="terminos.html">Términos y Condiciones</a> |
        <a href="privacidad.html">Política de Privacidad</a> |
        <a href="cookies.html">Política de Cookies</a><br>
        <span id="year"></span> © Todos los derechos reservados.
      </p>
    </div>
  </footer>

  <!-- Script principal con Supabase -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    // Configuración Supabase
    const supabaseUrl = 'https://xxvpfyiateyuniwrtrmm.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4dnBmeWlhdGV5dW5pd3J0cm1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNzI4ODYsImV4cCI6MjA3Nzg0ODg4Nn0.xCfhr8vK40SsyNIi6ro1v914x-017y2ZSbBkSqOAiyg'
    const supabase = createClient(supabaseUrl, supabaseKey)

    // Mostrar año actual en el footer
    document.getElementById('year').textContent = new Date().getFullYear()

    // Función para cargar habitaciones desde Supabase
    async function cargarHabitaciones() {
      const contenedor = document.querySelector('.listings')
      const { data, error } = await supabase.from('habitaciones').select('*')

      if (error) {
        contenedor.innerHTML = `<p>Error al cargar habitaciones: ${error.message}</p>`
        console.error(error)
        return
      }

      if (!data || data.length === 0) {
        contenedor.innerHTML = `<p>No hay habitaciones disponibles.</p>`
        return
      }

      contenedor.innerHTML = '' // Limpia el loader

      data.forEach(habitacion => {
        const card = document.createElement('article')
        card.classList.add('card')
        card.innerHTML = `
          <div class="card-image">
            <img src="${habitacion.fotos?.[0] || 'https://via.placeholder.com/400x250?text=Habitación'}" alt="${habitacion.titulo || 'Habitación'}">
          </div>
          <div class="card-body">
            <h3 class="card-title">${habitacion.titulo || 'Sin título'}</h3>
            <p class="price">${habitacion.precio_mes ? habitacion.precio_mes + ' €/mes' : 'Precio no disponible'}</p>
            <p class="location">${habitacion.ciudad || ''} ${habitacion.zona ? '· ' + habitacion.zona : ''}</p>
          </div>
        `
        contenedor.appendChild(card)
      })
    }

    // Ejecutar al cargar la página
    cargarHabitaciones()
  </script>
</body>
</html>
