<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roomix — Encuentra tu habitación</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="styles.css" />

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    /* Contenedor centrado para spinner y mensajes */
    .loading-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 300px;
      text-align: center;
      color: #333; /* Gris oscuro */
      font-family: 'Open Sans', sans-serif;
    }

    /* Spinner estilo Roomix */
    .spinner {
      border: 4px solid rgba(0,0,0,0.1);
      border-top: 4px solid #00B8A9; /* color principal */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Mensaje de carga y de no hay habitaciones */
    .loading-text {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .no-rooms {
      font-size: 1.1rem;
      font-weight: 600;
      color: #555;
      margin-top: 20px;
    }

    /* Optional: estilizar main para que quede centrado si no hay otras cards */
    main.container {
      min-height: 400px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <header class="site-header">
    <div class="container header-inner">
      <!-- LOGO -->
      <div class="logo">
        <a href="index.html" class="logo-link">
          <svg width="36" height="28" viewBox="0 0 24 20" aria-hidden="true" focusable="false">
            <path fill="#00B8A9" d="M12 1.5L1 9v9a1 1 0 0 0 1 1h6v-6h6v6h6a1 1 0 0 0 1-1V9L12 1.5z"/>
          </svg>
          <span class="brand">roomix</span>
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero-inner">
      <h1 class="hero-title">Tu próxima habitación te está esperando</h1>
      <p class="hero-sub">Conecta con personas afines y encuentra el espacio perfecto para vivir, compartir y disfrutar.</p>
    </div>
  </section>

  <!-- MAIN -->
  <main class="container main-content">
    <section class="listings" id="listingsContainer">
      <!-- Contenedor de spinner y mensajes -->
      <div class="loading-container" id="loadingContainer">
        <div class="spinner" id="loadingSpinner"></div>
        <div class="loading-text" id="loadingText">Cargando habitaciones disponibles...</div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p class="footer-slogan">Roomix — Conectando personas, creando hogares.</p>
      <p class="footer-legal">
        © <span id="year"></span> Todos los derechos reservados.
      </p>
    </div>
  </footer>

  <!-- SCRIPT -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabaseUrl = 'https://xxvpfyiateyuniwrtrmm.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4dnBmeWlhdGV5dW5pd3J0cm1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNzI4ODYsImV4cCI6MjA3Nzg0ODg4Nn0.xCfhr8vK40SsyNIi6ro1v914x-017y2ZSbBkSqOAiyg'
    const supabase = createClient(supabaseUrl, supabaseKey)

    document.getElementById('year').textContent = new Date().getFullYear()

    const loadingContainer = document.getElementById('loadingContainer')
    const spinner = document.getElementById('loadingSpinner')
    const loadingText = document.getElementById('loadingText')
    const listingsContainer = document.getElementById('listingsContainer')

    async function cargarHabitaciones(query = null) {
      // Mostrar spinner
      loadingContainer.style.display = 'flex'
      listingsContainer.style.justifyContent = 'center'
      listingsContainer.style.alignItems = 'center'

      let data, error
      if (query) {
        ({ data, error } = await query)
      } else {
        ({ data, error } = await supabase.from('habitaciones').select('*'))
      }

      // Ocultar spinner si hay datos
      if (data && data.length > 0) {
        loadingContainer.style.display = 'none'
        listingsContainer.style.justifyContent = 'flex-start'
        listingsContainer.style.alignItems = 'flex-start'

        listingsContainer.innerHTML = ''
        data.forEach(h => {
          const card = document.createElement('article')
          card.classList.add('card')
          card.innerHTML = `
            <div class="card-image">
              <img src="${h.fotos?.[0] || 'https://via.placeholder.com/400x250?text=Habitación'}" alt="${h.titulo || 'Habitación'}">
            </div>
            <div class="card-body">
              <h3 class="card-title">${h.titulo || 'Sin título'}</h3>
              <p class="price">${h.precio_mes ? h.precio_mes + ' €/mes' : 'Precio no disponible'}</p>
              <p class="location">${h.ciudad || ''} ${h.zona ? '· ' + h.zona : ''}</p>
            </div>
          `
          listingsContainer.appendChild(card)
        })
      } else {
        loadingText.textContent = 'No hay habitaciones disponibles.'
      }

      if (error) {
        loadingText.textContent = `Error: ${error.message}`
      }
    }

    // Carga inicial
    cargarHabitaciones()
  </script>

</body>
</html>
