<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roomix — Encuentra tu habitación</title>

  <!-- Enlaza la hoja de estilos -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Tipografía: Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

  <!-- NAVBAR -->
  <header class="site-header">
    <div class="container header-inner">

      <!-- LOGO -->
      <div class="logo">
        <a href="index.html" class="logo-link">
          <svg width="36" height="28" viewBox="0 0 24 20" aria-hidden="true" focusable="false">
            <path fill="#00B8A9" d="M12 1.5L1 9v9a1 1 0 0 0 1 1h6v-6h6v6h6a1 1 0 0 0 1-1V9L12 1.5z"/>
          </svg>
          <span class="brand">roomix</span>
        </a>
      </div>

      <!-- BARRA DE BÚSQUEDA ESCRITORIO -->
      <form id="searchForm" class="search-bar desktop-only">
        <div class="search-field">
          <span class="label">Provincia</span>
          <input type="text" id="provincia" placeholder="Provincia..." />
        </div>
        <div class="search-field">
          <span class="label">Municipio</span>
          <input type="text" id="municipio" placeholder="Municipio..." />
        </div>
        <button type="submit" class="search-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1 0 4.5 10.5a7.5 7.5 0 0 0 12.15 6.15z"
                  stroke="var(--accent)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>

      <!-- BARRA DE BÚSQUEDA MÓVIL (solo icono) -->
      <button class="mobile-search-btn mobile-only" id="openSearch">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1 0 4.5 10.5a7.5 7.5 0 0 0 12.15 6.15z"
                stroke="var(--white)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- ACCIONES -->
      <nav class="nav-actions">
        <a href="#" class="signin">Acceder</a>
        <a href="crear_cuenta.html" class="signup">Crear cuenta</a>
      </nav>

    </div>
  </header>

  <!-- BARRA DE BÚSQUEDA MÓVIL DESPLEGABLE -->
  <div class="mobile-search-panel mobile-only" id="mobileSearchPanel">
    <div class="mobile-search-box">
      <form id="mobileSearchForm">
        <div class="search-field">
          <input type="text" id="provincia-m" placeholder="Provincia..." />
        </div>
        <div class="search-field">
          <input type="text" id="municipio-m" placeholder="Municipio..." />
        </div>
        <button type="submit" id="mobileSearchBtn">Buscar</button>
      </form>
      <span id="closeSearch" class="close-search">✖</span>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero-inner">
      <h1 class="hero-title">Tu próxima habitación te está esperando</h1>
      <p class="hero-sub">Conecta con personas afines y encuentra el espacio perfecto para vivir, compartir y disfrutar.</p>
      <a class="cta" href="crear_cuenta.html">Comenzar</a>
    </div>
  </section>

  <!-- CARDS / LISTADO -->
  <main class="container main-content">
    <section class="listings">
      <p id="loading">Cargando habitaciones disponibles...</p>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p class="footer-slogan">Roomix — Conectando personas, creando hogares.</p>
      <p class="footer-legal">
        <a href="terminos.html">Términos y Condiciones</a> |
        <a href="privacidad.html">Política de Privacidad</a> |
        <a href="cookies.html">Política de Cookies</a><br><br>
        © <span id="year"></span> Todos los derechos reservados.
      </p>
    </div>
  </footer>

  <!-- SCRIPT PRINCIPAL -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabaseUrl = 'https://xxvpfyiateyuniwrtrmm.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
    const supabase = createClient(supabaseUrl, supabaseKey)

    // Mostrar año en el footer
    document.getElementById('year').textContent = new Date().getFullYear()

    // Función para cargar habitaciones
    async function cargarHabitaciones(query = null) {
      const contenedor = document.querySelector('.listings')
      let { data, error } = query || await supabase.from('habitaciones').select('*')

      if (error) {
        contenedor.innerHTML = `<p>Error: ${error.message}</p>`
        return
      }
      if (!data || data.length === 0) {
        contenedor.innerHTML = `<p>No hay habitaciones disponibles.</p>`
        return
      }

      contenedor.innerHTML = ''
      data.forEach(h => {
        const card = document.createElement('article')
        card.classList.add('card')
        card.innerHTML = `
          <div class="card-image">
            <img src="${h.fotos?.[0] || 'https://via.placeholder.com/400x250?text=Habitación'}" alt="${h.titulo || 'Habitación'}">
          </div>
          <div class="card-body">
            <h3 class="card-title">${h.titulo || 'Sin título'}</h3>
            <p class="price">${h.precio_mes ? h.precio_mes + ' €/mes' : 'Precio no disponible'}</p>
            <p class="location">${h.ciudad || ''} ${h.zona ? '· ' + h.zona : ''}</p>
          </div>
        `
        contenedor.appendChild(card)
      })
    }

    // Carga inicial
    cargarHabitaciones()

    // Búsqueda escritorio
    document.getElementById('searchForm').addEventListener('submit', async e => {
      e.preventDefault()
      let query = supabase.from('habitaciones').select('*')
      const prov = document.getElementById('provincia').value.trim()
      const muni = document.getElementById('municipio').value.trim()
      if (prov) query = query.ilike('ciudad', `%${prov}%`)
      if (muni) query = query.ilike('zona', `%${muni}%`)
      cargarHabitaciones(query)
    })

    // Búsqueda móvil
    const openSearch = document.getElementById('openSearch')
    const closeSearch = document.getElementById('closeSearch')
    const panel = document.getElementById('mobileSearchPanel')

    openSearch.addEventListener('click', () => panel.classList.add('active'))
    closeSearch.addEventListener('click', () => panel.classList.remove('active'))

    document.getElementById('mobileSearchForm').addEventListener('submit', async e => {
      e.preventDefault()
      const prov = document.getElementById('provincia-m').value.trim()
      const muni = document.getElementById('municipio-m').value.trim()
      let query = supabase.from('habitaciones').select('*')
      if (prov) query = query.ilike('ciudad', `%${prov}%`)
      if (muni) query = query.ilike('zona', `%${muni}%`)
      cargarHabitaciones(query)
      panel.classList.remove('active')
    })
  </script>

</body>
</html>
