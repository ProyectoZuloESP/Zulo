<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roomix ‚Äî Encuentra tu habitaci√≥n</title>

  <!-- Enlaza la hoja de estilos -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Tipograf√≠a: Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

  <!-- NAVBAR -->
  <header class="site-header">
    <div class="container header-inner">
      <!-- LOGO -->
      <div class="logo">
        <a href="index.html" class="logo-link">
          <svg width="36" height="28" viewBox="0 0 24 20" aria-hidden="true" focusable="false">
            <path fill="#00B8A9" d="M12 1.5L1 9v9a1 1 0 0 0 1 1h6v-6h6v6h6a1 1 0 0 0 1-1V9L12 1.5z"/>
          </svg>
          <span class="brand">roomix</span>
        </a>
      </div>

      <!-- BARRA DE B√öSQUEDA PC -->
      <form class="search-bar desktop-only" id="searchForm">
        <input type="text" id="provincia" placeholder="Provincia...">
        <input type="text" id="municipio" placeholder="Municipio...">
        <button type="submit">üîç</button>
      </form>

      <!-- ACCIONES -->
      <nav class="nav-actions">
        <a href="#" class="signin">Acceder</a>
        <a href="crear_cuenta.html" class="signup">Crear cuenta</a>
        <!-- ICONO B√öSQUEDA M√ìVIL -->
        <button class="mobile-search-btn mobile-only" id="openSearch">üîç</button>
      </nav>
    </div>
  </header>

  <!-- BARRA DE B√öSQUEDA M√ìVIL DESPLEGABLE -->
  <div class="mobile-search-panel mobile-only" id="mobileSearchPanel">
    <div class="mobile-search-box">
      <input type="text" id="provincia-m" placeholder="Provincia...">
      <input type="text" id="municipio-m" placeholder="Municipio...">
      <button id="mobileSearchBtn">Buscar</button>
      <span id="closeSearch" class="close-search">‚úñ</span>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero-inner">
      <h1 class="hero-title">Tu pr√≥xima habitaci√≥n te est√° esperando</h1>
      <p class="hero-sub">Conecta con personas afines y encuentra el espacio perfecto para vivir, compartir y disfrutar.</p>
      <a class="cta" href="crear_cuenta.html">Comenzar</a>
    </div>
  </section>

  <!-- CARDS / LISTADO -->
  <main class="container main-content">
    <section class="listings">
      <p id="loading">Cargando habitaciones disponibles...</p>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p class="footer-slogan">Roomix ‚Äî Conectando personas, creando hogares.</p>
      <p class="footer-legal">
        <a href="terminos.html">T√©rminos y Condiciones</a> |
        <a href="privacidad.html">Pol√≠tica de Privacidad</a> |
        <a href="cookies.html">Pol√≠tica de Cookies</a><br><br>
        ¬© <span id="year"></span> Todos los derechos reservados.
      </p>
    </div>
  </footer>

  <!-- SCRIPT PRINCIPAL CON SUPABASE Y B√öSQUEDA -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabaseUrl = 'https://xxvpfyiateyuniwrtrmm.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
    const supabase = createClient(supabaseUrl, supabaseKey)

    document.getElementById('year').textContent = new Date().getFullYear()

    // Funci√≥n para cargar habitaciones
    async function cargarHabitaciones(query = null) {
      const contenedor = document.querySelector('.listings')
      let { data, error } = await (query || supabase.from('habitaciones').select('*'))

      if (error) { contenedor.innerHTML = `<p>Error: ${error.message}</p>`; return }
      if (!data || data.length === 0) { contenedor.innerHTML = `<p>No hay habitaciones disponibles.</p>`; return }

      contenedor.innerHTML = ''
      data.forEach(h => {
        const card = document.createElement('article')
        card.classList.add('card')
        card.innerHTML = `
          <div class="card-image"><img src="${h.fotos?.[0] || 'https://via.placeholder.com/400x250?text=Habitaci√≥n'}" alt="${h.titulo || 'Habitaci√≥n'}"></div>
          <div class="card-body">
            <h3 class="card-title">${h.titulo || 'Sin t√≠tulo'}</h3>
            <p class="price">${h.precio_mes ? h.precio_mes + ' ‚Ç¨/mes' : 'Precio no disponible'}</p>
            <p class="location">${h.ciudad || ''} ${h.zona ? '¬∑ ' + h.zona : ''}</p>
          </div>
        `
        contenedor.appendChild(card)
      })
    }

    // Carga inicial
    cargarHabitaciones()

    // B√∫squeda PC
    document.getElementById('searchForm').addEventListener('submit', async e => {
      e.preventDefault()
      let query = supabase.from('habitaciones').select('*')
      const prov = document.getElementById('provincia').value.trim()
      const muni = document.getElementById('municipio').value.trim()
      if (prov) query = query.ilike('ciudad', `%${prov}%`)
      if (muni) query = query.ilike('zona', `%${muni}%`)
      cargarHabitaciones(query)
    })

    // BUSCADOR M√ìVIL
    const openSearch = document.getElementById('openSearch')
    const closeSearch = document.getElementById('closeSearch')
    const panel = document.getElementById('mobileSearchPanel')

    openSearch.addEventListener('click', () => panel.classList.add('active'))
    closeSearch.addEventListener('click', () => panel.classList.remove('active'))

    document.getElementById('mobileSearchBtn').addEventListener('click', async () => {
      const prov = document.getElementById('provincia-m').value.trim()
      const muni = document.getElementById('municipio-m').value.trim()
      let query = supabase.from('habitaciones').select('*')
      if (prov) query = query.ilike('ciudad', `%${prov}%`)
      if (muni) query = query.ilike('zona', `%${muni}%`)
      cargarHabitaciones(query)
      panel.classList.remove('active')
    })
  </script>

</body>
</html>
